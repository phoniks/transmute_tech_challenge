"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t,n=e(require("express")),r=e(require("express-session")),o=e(require("body-parser")),i=e(require("express-flash")),s=e(require("connect-mongo")),a=e(require("path")),c=require("@sidetree/element"),l=require("@sidetree/ethereum"),d=require("dotenv"),u=e(require("web3")),g=require("@sidetree/cas");d.config(),t=__dirname+"/../../.env.production",d.config({path:t}),process,process,process;var p="mongodb://localhost:27017/element-test",h=new l.EthereumLedger(new u(new u.providers.HttpProvider("http://127.0.0.1:8545")),"0x74435D1c1018798243d201B5f4e6187c62562E72");h.initialize();var v={batchingIntervalInSeconds:360,contentAddressableStoreServiceUri:"",didMethodName:"elem:ropsten",maxConcurrentDownloads:1,observingIntervalInSeconds:360,mongoDbConnectionString:"mongodb://localhost:27017/",databaseName:"element-test"},m=[];console.log(h);var b=new c.Element(v,m,h);b.initialize();var f=b.handleOperationRequest,S=b.handleResolveRequest,k=b.handleGetVersionRequest,E=process.env.ELEMENT_IPFS_MULTIADDR?process.env.ELEMENT_IPFS_MULTIADDR:"IPFS_ADDY",_=new g.IpfsCasWithCache(E,p,"element-test");_.initialize();var q=process.env.SESSION_SECRET?process.env.SESSION_SECRET:"somesecretthingthatyoushouldntshare",T=s(r),w=n();w.set("port",process.env.PORT||3e3),w.use(o.json()),w.use(o.urlencoded({extended:!0})),w.use(r({resave:!0,saveUninitialized:!0,secret:q,store:new T({url:p,autoReconnect:!0})})),w.use(i()),w.use(n.static(a.join(__dirname,"public"),{maxAge:315576e5})),w.get("/",(function(){})),w.post("/operations",f),w.get("/identifiers/:did",S),w.get("/version",k),w.get("/blockchain/time",h.getLatestTime),w.get("​/blockchain​/time​/:time-hash",h.getLatestTime),w.get("/blockchain​/transactions",(function(e){var t=e.body;h._getTransactions(t.startBlock,t.endBlock)})),w.post("/blockchain/transactions",(function(e){h.write(e.body.anchorString,e.body._fee)})),w.post("/blockchain/transactions/first-valid",h.getFirstValidTransaction),w.get("/blockchain/fee",h.getFee),w.get("/blockchain/locks/:lock-identifier",h.getValueTimeLock),w.get("/blockchain/writer-lock",h.getWriterValueTimeLock),w.post("/blockchain/version",h.getServiceVersion),w.post("/cas",_.write),w.get("/cas/version",_.getServiceVersion),w.get("/cas/:hash",_.write),w.listen(3e3),console.log("api listening on port 3000"),exports.default=w;
//# sourceMappingURL=server.cjs.production.min.js.map
