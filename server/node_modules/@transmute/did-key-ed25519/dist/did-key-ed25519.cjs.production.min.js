"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var r=e(require("base64url")),t=require("@stablelib/ed25519"),i=e(require("canonicalize")),n=e(require("bs58")),o=e(require("crypto")),u=require("@transmute/did-key-common"),c=require("tslib"),f=require("@transmute/did-key-x25519");function a(){return(a=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,r){return(l=Object.setPrototypeOf||function(e,r){return e.__proto__=r,e})(e,r)}function y(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function p(e,r,t){return(p=y()?Reflect.construct:function(e,r,t){var i=[null];i.push.apply(i,r);var n=new(Function.bind.apply(e,i));return t&&l(n,t.prototype),n}).apply(null,arguments)}function d(e){var r="function"==typeof Map?new Map:void 0;return(d=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(e))return r.get(e);r.set(e,t)}function t(){return p(e,arguments,s(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),l(t,e)})(e)}var v,K=function(e){var r,t;function i(r){var t;return(t=e.call(this,r)||this).name="JWSVerificationFailed",t}return t=e,(r=i).prototype=Object.create(t.prototype),r.prototype.constructor=r,r.__proto__=t,i}(d(Error)),b=function(e){var t=r.toBuffer(e.d),i=r.toBuffer(e.x);return new Uint8Array(Buffer.concat([t,i]))},h=function(e){var t=r.toBuffer(e.x);return new Uint8Array(t)},B=function(e,t){void 0===t&&(t={complete:!1});var i=e.split("."),n=i[1],o=i[2];return t.complete?{header:JSON.parse(r.decode(i[0])),payload:JSON.parse(r.decode(n)),signature:o}:JSON.parse(r.decode(n))},m=function(e,n,o){void 0===o&&(o={alg:"EdDSA"});var u=b(n),c=r.encode(i(o)),f=r.encode(i(e)),a=new Uint8Array(Buffer.from(c+"."+f)),s=t.sign(u,a);return c+"."+f+"."+r.encode(Buffer.from(s))},g=function(e,n,o){void 0===o&&(o={alg:"EdDSA"});var u=b(n),c=r.encode(i(o)),f=new Uint8Array(Buffer.concat([Buffer.from(c,"utf-8"),Buffer.from(".","utf-8"),e])),a=t.sign(u,f);return c+".."+r.encode(Buffer.from(a))},w=function(e,i){var n=h(i),o=e.split("."),u=o[1],c=o[2],f=new Uint8Array(Buffer.from(o[0]+"."+u));if(t.verify(n,f,new Uint8Array(r.toBuffer(c))))return JSON.parse(r.decode(u));throw new K("signature verification failed")},P=function(e,i,n){var o=h(n),u=e.split(".."),c=u[1],f=new Uint8Array(Buffer.concat([Buffer.from(u[0],"utf-8"),Buffer.from(".","utf-8"),i]));return t.verify(o,f,new Uint8Array(r.toBuffer(c)))},k={__proto__:null,decode:B,sign:m,signDetached:g,verify:w,verifyDetached:P,default:{decode:B,sign:m,signDetached:g,verify:w,verifyDetached:P}},_=function(e){var t=a({},e);delete t.d,delete t.kid,delete t.alg;var n=o.createHash("sha256").update(i(t)).digest();return r.encode(Buffer.from(n))},x=function(e){var t={crv:"Ed25519",x:r.encode(n.decode(e)),kty:"OKP"};return a({},t,{kid:_(t)})},J=function(e){var t=n.decode(e),i={crv:"Ed25519",d:r.encode(t.slice(0,32)),x:r.encode(t.slice(32,64)),kty:"OKP"};return a({},i,{kid:_(i)})},E=function(e){return n.encode(r.toBuffer(e.x))},O=function(e){return n.encode(Buffer.concat([r.toBuffer(e.d),r.toBuffer(e.x)]))},F={__proto__:null,getKid:_,publicKeyBase58FromPublicKeyHex:function(e){return n.encode(Buffer.from(e,"hex"))},privateKeyBase58FromPrivateKeyHex:function(e){return n.encode(Buffer.from(e,"hex"))},publicKeyJwkFromPublicKeyBase58:x,privateKeyJwkFromPrivateKeyBase58:J,publicKeyBase58FromPublicKeyJwk:E,privateKeyBase58FromPrivateKeyJwk:O,publicKeyHexFromPublicKeyBase58:function(e){return n.decode(e).toString("hex")},privateKeyHexFromPrivateKeyBase58:function(e){return n.decode(e).toString("hex")}};exports.Ed25519KeyPair=v=function(){function e(e){if(void 0===e&&(e={}),this.type="Ed25519VerificationKey2018",this.id=e.id,this.controller=e.controller,e.publicKeyBase58)this.publicKeyBuffer=n.decode(e.publicKeyBase58);else{if(!e.publicKeyJwk)throw new Error("Ed25519KeyPair requires publicKeyBase58 or publicKeyJwk, recieved neither.");this.publicKeyBuffer=n.decode(E(e.publicKeyJwk))}e.privateKeyBase58&&(this.privateKeyBuffer=n.decode(e.privateKeyBase58)),this.controller&&!this.id&&(this.id=this.controller+"#"+this.fingerprint())}e.fingerprintFromPublicKey=function(e){var r;e.publicKeyBase58&&(r=n.decode(e.publicKeyBase58)),e.publicKeyJwk&&(r=n.decode(E(e.publicKeyJwk)));var t=new Uint8Array(2+r.length);return t[0]=237,t[1]=1,t.set(r,2),"z"+n.encode(t)},e.generate=function(e){try{var r;if(!e.secureRandom)throw new Error("options.secureRandom is required.");r=t.generateKeyPair({isAvailable:!0,randomBytes:e.secureRandom});var i=n.encode(r.publicKey),o=n.encode(r.secretKey),u="did:key:"+v.fingerprintFromPublicKey({publicKeyBase58:i}),c="#"+v.fingerprintFromPublicKey({publicKeyBase58:i});return Promise.resolve(new v({id:c,controller:u,publicKeyBase58:i,privateKeyBase58:o}))}catch(e){return Promise.reject(e)}},e.fromFingerprint=function(e){var r=e.fingerprint,t=n.decode(r.substr(1));if(237===t[0]&&1===t[1]){var i=n.encode(t.slice(2)),o="did:key:"+v.fingerprintFromPublicKey({publicKeyBase58:i}),u="#"+v.fingerprintFromPublicKey({publicKeyBase58:i});return new v({id:u,controller:o,publicKeyBase58:i})}throw new Error("Unsupported Fingerprint Type: "+r)},e.from=function(e){var r,t;return e.publicKeyBase58&&(t=e.publicKeyBase58),e.privateKeyBase58&&(r=e.privateKeyBase58),e.privateKeyJwk&&(r=O(e.privateKeyJwk)),e.publicKeyJwk&&(t=E(e.publicKeyJwk)),new v(a({},e,{privateKeyBase58:r,publicKeyBase58:t}))};var r=e.prototype;return r.publicNode=function(){return this.toKeyPair(!1)},r.fingerprint=function(){return v.fingerprintFromPublicKey({publicKeyBase58:n.encode(this.publicKeyBuffer)})},r.verifyFingerprint=function(e){if("string"!=typeof e||"z"!==e[0])return{error:new Error("`fingerprint` must be a multibase encoded string."),valid:!1};var r;try{r=n.decode(e.slice(1))}catch(e){return{error:e,valid:!1}}var t="ed01"===r.slice(0,2).toString("hex")&&this.publicKeyBuffer.equals(r.slice(2));return t?{valid:t}:{error:new Error("The fingerprint does not match the public key."),valid:!1}},r.toJwk=function(e){void 0===e&&(e=!1);try{return Promise.resolve(e?J(n.encode(this.privateKeyBuffer)):x(n.encode(this.publicKeyBuffer)))}catch(e){return Promise.reject(e)}},r.toX25519KeyPair=function(e){return void 0===e&&(e=!1),f.X25519KeyPair.fromEdKeyPair(e?{controller:this.controller,publicKeyBase58:n.encode(this.publicKeyBuffer),privateKeyBase58:n.encode(this.privateKeyBuffer)}:{controller:this.controller,publicKeyBase58:n.encode(this.publicKeyBuffer)})},r.toKeyPair=function(e){void 0===e&&(e=!1);var r={id:this.id,type:this.type,controller:this.controller,publicKeyBase58:n.encode(this.publicKeyBuffer)};return e&&(r.privateKeyBase58=n.encode(this.privateKeyBuffer)),r},r.toJsonWebKeyPair=function(e){void 0===e&&(e=!1);var r={id:this.id,type:"JsonWebKey2020",controller:this.controller,publicKeyJwk:x(n.encode(this.publicKeyBuffer))};return delete r.publicKeyJwk.kid,e&&(r.privateKeyJwk=J(n.encode(this.privateKeyBuffer)),delete r.privateKeyJwk.kid),r},r.signer=function(){if(!this.privateKeyBuffer)throw new Error("No private key to sign with.");var e=this.privateKeyBuffer;return{sign:function(r){var i=r.data;try{var n=t.sign(e,i);return Promise.resolve(n)}catch(e){return Promise.reject(e)}}}},r.verifier=function(){if(!this.publicKeyBuffer)throw new Error("No public key to verify with.");var e=this.publicKeyBuffer;return{verify:function(r){var i=r.data,n=r.signature;try{var o=!1;try{o=t.verify(e,i,n)}catch(e){console.error("An error occurred when verifying signature: ",e)}return Promise.resolve(o)}catch(e){return Promise.reject(e)}}}},e}(),exports.Ed25519KeyPair=v=c.__decorate([u.types.staticImplements()],exports.Ed25519KeyPair);var j=u.getResolve(exports.Ed25519KeyPair),A={__proto__:null,resolve:j,get:u.getGet(j)};exports.EdDSA=k,exports.driver=A,exports.keyUtils=F;
//# sourceMappingURL=did-key-ed25519.cjs.production.min.js.map
