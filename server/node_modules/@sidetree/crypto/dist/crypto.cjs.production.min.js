"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var r=require("@transmute/did-key-ed25519"),n=require("@transmute/did-key-secp256k1"),t=require("bip39"),o=e(require("hdkey")),i=e(require("base64url")),u=e(require("canonicalize"));const c=function(){function e(){}return e.prototype.then=function(r,n){const t=new e,o=this.s;if(o){const e=1&o?r:n;if(e){try{f(t,1,e(this.v))}catch(e){f(t,2,e)}return t}return this}return this.o=function(e){try{const o=e.v;1&e.s?f(t,1,r?r(o):o):n?f(t,1,n(o)):f(t,2,o)}catch(e){f(t,2,e)}},t},e}();function f(e,r,n){if(!e.s){if(n instanceof c){if(!n.s)return void(n.o=f.bind(null,e,r));1&r&&(r=n.s),n=n.v}if(n&&n.then)return void n.then(f.bind(null,e,r),f.bind(null,e,2));e.s=r,e.v=n;const t=e.o;t&&t(e)}}function s(e,r){var n,t=-1;e:{for(var o=0;o<r.length;o++){var i=r[o][0];if(i){var u=i();if(u&&u.then)break e;if(u===e){t=o;break}}else t=o}if(-1!==t){do{for(var s=r[t][1];!s;)t++,s=r[t][1];var a=s();if(a&&a.then){n=!0;break e}var v=r[t][2];t++}while(v&&!v());return a}}const h=new c,d=f.bind(null,h,2);return(n?a.then(m):u.then((function n(u){for(;;){if(u===e){t=o;break}if(++o===r.length){if(-1!==t)break;return void f(h,1,s)}if(i=r[o][0]){if((u=i())&&u.then)return void u.then(n).then(void 0,d)}else t=o}do{for(var c=r[t][1];!c;)t++,c=r[t][1];var s=c();if(s&&s.then)return void s.then(m).then(void 0,d);var a=r[t][2];t++}while(a&&!a());f(h,1,s)}))).then(void 0,d),h;function m(e){for(;;){var n=r[t][2];if(!n||n())break;t++;for(var o=r[t][1];!o;)t++,o=r[t][1];if((e=o())&&e.then)return void e.then(m).then(void 0,d)}f(h,1,e)}}"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var a={secp256k1:"ES256K",Ed25519:"EdDSA"};exports.ed25519=r,exports.secp256k1=n,exports.createJwsSigner=function(e){try{return Promise.resolve(function(e){try{var t,o=function(){if(!t)throw new Error("Unsupported crv "+e.crv);var r=t.signer();return{sign:function(e){return r.sign({data:e})}}},i=s(e.crv,[[function(){return"Ed25519"},function(){return Promise.resolve(r.Ed25519KeyPair.from({publicKeyJwk:e,privateKeyJwk:e})).then((function(e){t=e}))}],[function(){return"secp256k1"},function(){return Promise.resolve(n.Secp256k1KeyPair.from({publicKeyJwk:e,privateKeyJwk:e})).then((function(e){t=e}))}]]);return Promise.resolve(i&&i.then?i.then(o):o())}catch(e){return Promise.reject(e)}}(e)).then((function(r){var n=a[e.crv];return{sign:function(e){try{return Promise.resolve(function(e,r,n){try{var t=i.encode(u(n))+"."+i.encode(u(r));return Promise.resolve(e.sign(Buffer.from(t))).then((function(e){return t+"."+i.encode(Buffer.from(e))}))}catch(e){return Promise.reject(e)}}(r,e,{alg:n}))}catch(e){return Promise.reject(e)}}}}))}catch(e){return Promise.reject(e)}},exports.createJwsVerifier=function(e){try{return Promise.resolve(function(e){try{var t,o=function(){if(!t)throw new Error("Unsupported crv "+e.crv);var r=t.verifier();return{verify:function(e,n){return r.verify({data:e,signature:n})}}},i=s(e.crv,[[function(){return"Ed25519"},function(){return Promise.resolve(r.Ed25519KeyPair.from({publicKeyJwk:e})).then((function(e){t=e}))}],[function(){return"secp256k1"},function(){return Promise.resolve(n.Secp256k1KeyPair.from({publicKeyJwk:e})).then((function(e){t=e}))}]]);return Promise.resolve(i&&i.then?i.then(o):o())}catch(e){return Promise.reject(e)}}(e)).then((function(e){return{verify:function(r){try{return Promise.resolve(function(e,r){try{var n=r.split("."),t=n[2];return Promise.resolve(e.verify(Buffer.from(n[0]+"."+n[1]),i.toBuffer(t)))}catch(e){return Promise.reject(e)}}(e,r))}catch(e){return Promise.reject(e)}}}}))}catch(e){return Promise.reject(e)}},exports.generateMnemonic=function(){try{return Promise.resolve(t.generateMnemonic())}catch(e){return Promise.reject(e)}},exports.toKeyPair=function(e,i,u){void 0===u&&(u="Ed25519");try{return Promise.resolve(t.mnemonicToSeed(e)).then((function(e){var t,c=o.fromMasterSeed(e).derive("m/44'/1'/0'/0/"+i),f=s(u,[[function(){return"secp256k1"},function(){return Promise.resolve(n.Secp256k1KeyPair.generate({secureRandom:function(){return c._privateKey}})).then((function(e){t=e}))}],[function(){return"X25519"},function(){return Promise.resolve(r.Ed25519KeyPair.generate({secureRandom:function(){return c._privateKey}})).then((function(e){t=(t=e).toX25519KeyPair(!0)}))}],[function(){return"Ed25519"}],[void 0,function(){return Promise.resolve(r.Ed25519KeyPair.generate({secureRandom:function(){return c._privateKey}})).then((function(e){t=e}))}]]);return f&&f.then?f.then((function(){return t})):t}))}catch(e){return Promise.reject(e)}};
//# sourceMappingURL=crypto.cjs.production.min.js.map
